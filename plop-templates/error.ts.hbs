/**
 * {{pascalCase name}} error classes
 * Generated by Plop - customize as needed
 */

export interface ErrorDetails {
  message: string;
  code?: string;
  statusCode?: number;
  context?: Record<string, any>;
  timestamp?: Date;
}

/**
 * Base error class for {{pascalCase name}}
 */
export class {{pascalCase name}}Error extends Error {
  public readonly code?: string;
  public readonly statusCode?: number;
  public readonly context?: Record<string, any>;
  public readonly timestamp: Date;

  constructor(details: ErrorDetails | string) {
    const errorDetails = typeof details === 'string' 
      ? { message: details }
      : details;

    super(errorDetails.message);
    
    this.name = '{{pascalCase name}}Error';
    this.code = errorDetails.code;
    this.statusCode = errorDetails.statusCode;
    this.context = errorDetails.context;
    this.timestamp = errorDetails.timestamp || new Date();

    // Maintains proper stack trace for where error was thrown (Node.js only)
    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, {{pascalCase name}}Error);
    }
  }

  /**
   * Serializes the error to a plain object
   */
  toJSON(): Record<string, any> {
    return {
      name: this.name,
      message: this.message,
      code: this.code,
      statusCode: this.statusCode,
      context: this.context,
      timestamp: this.timestamp.toISOString(),
      stack: this.stack,
    };
  }

  /**
   * Creates a user-friendly error message
   */
  toUserMessage(): string {
    return this.message || 'An unexpected error occurred';
  }
}

/**
 * Validation error for {{pascalCase name}}
 */
export class {{pascalCase name}}ValidationError extends {{pascalCase name}}Error {
  constructor(message: string, field?: string, value?: any) {
    super({
      message,
      code: 'VALIDATION_ERROR',
      statusCode: 400,
      context: { field, value },
    });
    this.name = '{{pascalCase name}}ValidationError';
  }
}

/**
 * Not found error for {{pascalCase name}}
 */
export class {{pascalCase name}}NotFoundError extends {{pascalCase name}}Error {
  constructor(resource: string, identifier?: string) {
    super({
      message: `${resource}${identifier ? ` with identifier '${identifier}'` : ''} not found`,
      code: 'NOT_FOUND',
      statusCode: 404,
      context: { resource, identifier },
    });
    this.name = '{{pascalCase name}}NotFoundError';
  }
}

/**
 * Permission error for {{pascalCase name}}
 */
export class {{pascalCase name}}PermissionError extends {{pascalCase name}}Error {
  constructor(action: string, resource?: string) {
    super({
      message: `Permission denied${resource ? ` for ${resource}` : ''}: ${action}`,
      code: 'PERMISSION_DENIED',
      statusCode: 403,
      context: { action, resource },
    });
    this.name = '{{pascalCase name}}PermissionError';
  }
}

/**
 * Network/API error for {{pascalCase name}}
 */
export class {{pascalCase name}}NetworkError extends {{pascalCase name}}Error {
  constructor(message: string, statusCode?: number, url?: string) {
    super({
      message,
      code: 'NETWORK_ERROR',
      statusCode: statusCode || 500,
      context: { url },
    });
    this.name = '{{pascalCase name}}NetworkError';
  }
}

/**
 * Error handler utility
 */
export const handle{{pascalCase name}}Error = (error: unknown): {{pascalCase name}}Error => {
  if (error instanceof {{pascalCase name}}Error) {
    return error;
  }

  if (error instanceof Error) {
    return new {{pascalCase name}}Error({
      message: error.message,
      code: 'UNKNOWN_ERROR',
      context: { originalError: error.constructor.name },
    });
  }

  return new {{pascalCase name}}Error({
    message: 'An unknown error occurred',
    code: 'UNKNOWN_ERROR',
    context: { error },
  });
};

/**
 * Type guard for {{pascalCase name}}Error
 */
export const is{{pascalCase name}}Error = (error: unknown): error is {{pascalCase name}}Error => {
  return error instanceof {{pascalCase name}}Error;
};